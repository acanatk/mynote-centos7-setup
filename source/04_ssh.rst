**********************************************************************
SSHセットアップ
**********************************************************************

他の環境からサーバにログインするため、SSHをセットアップします。

======================================================================
サーバ側のセットアップ
======================================================================
----------------------------------------------------------------------
SSH設定ファイル変更
----------------------------------------------------------------------

/etc/ssh/sshd_configファイルの次のパラメータを変更する。

.. code-block:: text

    PermitRootLogin no
    PermitEmptyPasswords no
    PasswordAuthentication no

SSHを再起動して、設定を反映する。

.. code-block:: bash

    $ systemctl restart ssh

----------------------------------------------------------------------
SSH秘密鍵と公開鍵生成
----------------------------------------------------------------------

SSHの秘密鍵と公開鍵を生成します。

サーバにログインし、**ssh-keygen** コマンドを実行します。

.. code-block:: bash

    $ ssh-keygen -t rsa
    Generating public/private rsa key pair.
    Enter file in which to save the key (/home/foo/.ssh/id_rsa): 

ファイル名の入力を求められます。デフォルトのままでよければ **ENTER** キーを入力します。

.. code-block:: bash

    Created directory '/home/foo/.ssh'.
    Enter passphrase (empty for no passphrase): 
    Enter same passphrase again: 

次に、パスフレーズの入力を求められるので、確認も含め2回入力します。

.. code-block:: bash

    Your identification has been saved in /home/foo/.ssh/id_rsa.
    Your public key has been saved in /home/foo/.ssh/id_rsa.pub.
    The key fingerprint is:
      :

$HOME/.sshフォルダに秘密鍵と公開鍵が次のファイル名で生成されます。

.. list-table::
   :header-rows: 1

   * - 
     - ファイル名
   * - 秘密鍵
     - $HOME/.ssh/id_rsa
   * - 公開鍵
     - $HOME/.ssh/id_rsa.pub

秘密鍵はクライアント側で使用し、公開鍵はサーバ側で使用します。

----------------------------------------------------------------------
SSH公開鍵の配置
----------------------------------------------------------------------

公開鍵のファイル名とアクセス権を次のように変更します。

.. code-block:: bash

    $ mv ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
    $ chmod 600 ~/.ssh/authorized_keys 

======================================================================
クライアント側のセットアップ
======================================================================

----------------------------------------------------------------------
SSH秘密鍵の配置
----------------------------------------------------------------------

秘密鍵はFTPなどでサーバからクライアントにコピーしたあと、$HOME/.sshフォルダに配置する。

.. code-block:: bash

    $ mkdir ~/.ssh
    $ chmod 700 ~/.ssh
    $ mv id_rsa ~/.ssh

----------------------------------------------------------------------
SSHでサーバに接続
----------------------------------------------------------------------

**ssh** コマンドの書式は次のとおりです。

.. code-block:: bash

    ssh username@hostname

